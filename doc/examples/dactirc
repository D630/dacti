#!/usr/bin/env bash

term=stt
prompt=\>
DACTI_INDEX_FILE=${X_XDG_LIB_DIR}/dacti/dacti.index
DACTI_PRETEND=0

menu=(
    ADDRESSES
    BIN-ASC
    BIN-ATIME-ASC
    BIN-ATIME-DESC
    BIN-DESC
    CALC
    CLIP
    FILE
    KUNO
    PW
    RADIO
    TASK-ADD
    WEB
    WECKER
    Z
)

function Dacti::CmdMenuCustom ()
{
    builtin typeset prompt="$1"

    case $invocation_mode in
    cli)
            command /usr/local/bin/slmenu -b -f -i \
                    -p "$prompt" \
                    -nb "#002b36" \
                    -nf "#839496" \
                    -sb "#839496" \
                    -sf "#2C2C2C" \
                    -uc "#2C2C2C" \
                    -fn "-xos4-terminus-medium-r-normal-*-18-*-*-*-*-*-iso10646-*" ;
    ;;
    gui)
            command /usr/local/bin/dmenu2 -b -f -i \
                    -l "10" \
                    -p "$prompt" \
                    -nb "#002b36" \
                    -nf "#839496" \
                    -sb "#839496" \
                    -sf "#2C2C2C" \
                    -uc "#2C2C2C" \
                    -fn "-xos4-terminus-medium-r-normal-*-18-*-*-*-*-*-iso10646-*" \
                    -name "dacti" \
                    -class "dacti" ;
    esac
}

function Dacti::ParseSelectionCustom ()
{
        builtin typeset selection="$@"

        case ${selection,,} in
        z)
                builtin exec z-fm.sh
        ;;
        clip)
                builtin exec clipbored.sh
        ;;
        web)
                if
                        [[ $invocation_mode == cli ]]
                then
                        builtin exec furlview.sh "${X_XDG_LOG_HOME}/urls.log"
                elif
                        [[ $invocation_mode == gui ]]
                then
                        command xterm -name "furlview-xterm" -e "furlview.sh "${X_XDG_LOG_HOME}/urls.log";exit;bash"
                        builtin exit 0
                fi
        ;;
        radio)
                builtin exec webradio.sh
        ;;
        file)
                builtin exec special-files.sh
        ;;
        pw)
                builtin exec pass-c.sh
        ;;
        addresses)
                if
                        [[ $invocation_mode == cli ]]
                then
                        builtin exec nottoomuch-wrapper.sh
                elif
                        [[ $invocation_mode == gui ]]
                then
                        ( builtin exec ${term} -e "${SHELL:-sh}" -c nottoomuch-wrapper.sh 2>/dev/null & )
                        builtin exit 0
                fi
        ;;
        task-add)
                if
                        [[ $invocation_mode == cli ]]
                then
                        builtin exec taskwarrior-add.sh
                elif
                        [[ $invocation_mode == gui ]]
                then
                        ( builtin exec ${term} -e "${SHELL:-sh}" -c taskwarrior-add.sh 2>/dev/null & )
                        builtin exit 0
                fi
        ;;
        kuno)
                if
                        [[ $invocation_mode == cli ]]
                then
                        builtin exec kuno.sh
                elif
                        [[ $invocation_mode == gui ]]
                then
                        ( builtin exec ${term} -e "${SHELL:-sh}" -c kuno.sh 2>/dev/null & )
                        builtin exit 0
                fi
        ;;
        wecker)
                builtin exec wecker-gui.sh
        ;;
        calc)
                if
                        [[ $invocation_mode == cli ]]
                then
                        builtin exec calc.sh
                elif
                        [[ $invocation_mode == gui ]]
                then
                        ( builtin exec ${term} -e "${SHELL:-sh}" -c calc.sh 2>/dev/null & )
                        builtin exit 0
                fi
        ;;
        *)
                builtin return 1
        esac
}

function Dacti::RaiseAppSgCustom ()
{
        ## dacti wants to raise an single window

        command wmctrl -i -a "${xids[0]}" || {
                launch_status=fail
                builtin return 1
        }
}

function Dacti::RaiseAppPlCustom ()
{
        ## dacti has detected at leat two windows to raise

        builtin typeset id

        for id
        do
                Dacti::RaiseAppSgCustom "$id" || {
                        launch_status=fail
                        builtin return 1
                }
        done
}

